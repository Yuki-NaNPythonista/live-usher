# ライブ会場入場権利確認システム

CAMPFIRE IDを使用してライブ会場の入場権利を確認するWebアプリケーションです。

## 概要

このシステムは、ライブ会場において来場者のCAMPFIRE IDを基に入場権利の有無を即座に確認し、スムーズな入場管理を実現します。スマートフォンに最適化されたUIで、会場スタッフが簡単に操作できます。

## 主な機能

- **CAMPFIRE ID入力**: シンプルで使いやすい入力フォーム
- **即座に照合**: Googleスプレッドシートのデータと自動照合
- **視覚的な結果表示**: 入場OK/NGを色とアイコンで分かりやすく表示
- **スマートフォン最適化**: iOS Safari、Android Chrome対応
- **レスポンシブデザイン**: 様々な画面サイズに対応

## 技術スタック

- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
- **バックエンド**: Google Apps Script
- **ホスティング**: GitHub Pages
- **データ管理**: Google スプレッドシート
- **依存関係**: なし（完全スタンドアロン）

## プロジェクト構成

```
live-usher/
├── index.html          # メインHTMLファイル
├── style.css           # スタイルシート
├── script.js           # JavaScript (API呼び出し、UI制御)
├── Gas.js              # Google Apps Scriptコード (スプレッドシートにデプロイ)
├── 要件定義書.md        # 要件定義書
├── 詳細仕様書.md        # 詳細仕様書
├── README.md           # このファイル
└── .gitignore          # Git除外設定
```

## セットアップ手順

### 1. Googleスプレッドシートの準備

#### 1.1 スプレッドシートの作成
1. [Google スプレッドシート](https://sheets.google.com/)で新規スプレッドシートを作成
2. シート名を「**入場者リスト**」に変更

#### 1.2 データの入力
以下の形式でデータを入力します（1行目はヘッダー行）:

| A列: CAMPFIRE_ID | B列: 氏名 | C列: リターン内容 | D列: 入場権利 | E列: リハ見学権利 | F列: 備考 |
|-----------------|----------|-----------------|--------------|----------------|---------|
| user12345       | 山田太郎  | 入場券+グッズ    | 有           | 有             | VIP席   |
| user67890       | 佐藤花子  | 入場券のみ       | 有           | 無             |         |
| user11111       | 鈴木一郎  | グッズのみ       | 無           | 無             | 入場権なし |

**重要**:
- A列 (CAMPFIRE_ID) は必須でユニーク
- D列 (入場権利) は「**有**」または「**無**」で入力
- E列 (リハ見学権利) は「**有**」または「**無**」で入力

### 2. Google Apps Scriptのデプロイ

#### 2.1 Apps Scriptエディタを開く
1. スプレッドシートで「**拡張機能**」→「**Apps Script**」をクリック
2. 新しいタブでApps Scriptエディタが開きます

#### 2.2 コードの貼り付け
1. `Gas.js` ファイルの内容をすべてコピー
2. Apps Scriptエディタに貼り付け（既存のコードを置き換え）
3. プロジェクト名を設定（例: ライブ入場確認API）
4. 「保存」ボタンをクリック

#### 2.3 Webアプリとしてデプロイ
1. 「**デプロイ**」→「**新しいデプロイ**」をクリック
2. 「種類の選択」で「**ウェブアプリ**」を選択
3. 設定:
   - **説明**: ライブ入場確認API
   - **実行ユーザー**: 自分
   - **アクセスできるユーザー**: **全員**
4. 「**デプロイ**」ボタンをクリック
5. 権限の承認を求められた場合は、指示に従って承認
6. **デプロイURLをコピー**（重要: 後で使用します）
   - 例: `https://script.google.com/macros/s/XXXXXXXX.../exec`

### 3. フロントエンドの設定

#### 3.1 Apps Script URLの設定
1. `script.js` ファイルを開く
2. 1行目の以下の部分を編集:
```javascript
const SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';
```
↓
```javascript
const SCRIPT_URL = 'https://script.google.com/macros/s/XXXXXXXX.../exec';
```
（先ほどコピーしたデプロイURLを貼り付け）

3. ファイルを保存

### 4. GitHub Pagesでのデプロイ

#### 4.1 GitHubへのプッシュ
```bash
git add .
git commit -m "Initial setup: Live entrance check system"
git push origin main
```

#### 4.2 GitHub Pagesの有効化
1. GitHubリポジトリページを開く
2. 「**Settings**」タブをクリック
3. 左サイドバーから「**Pages**」を選択
4. Source設定:
   - **Source**: Deploy from a branch
   - **Branch**: main (または master)
   - **Folder**: / (root)
5. 「**Save**」をクリック
6. 数分後、公開URLが表示されます
   - 例: `https://username.github.io/live-usher/`

### 5. QRコードの作成

#### 5.1 QRコード生成
1. GitHub PagesのURLをコピー
2. QRコード生成サービスを使用
   - [QRコード作成 (Google)](https://www.google.com/search?q=qr+code+generator)
   - [QR Code Generator](https://www.qr-code-generator.com/)
3. URLからQRコードを生成

#### 5.2 印刷と設置
1. QRコードを印刷
2. ラミネート加工（推奨）
3. 会場の入り口など、来場者が見やすい場所に設置

## 使い方

### 来場者向け操作マニュアル

#### 1. QRコードの読み取り
- 会場入口に設置されているQRコードをスマートフォンのカメラで読み取ります
- iPhoneの場合: 標準カメラアプリで読み取り可能
- Androidの場合: カメラアプリまたはQRコードリーダーアプリで読み取り

#### 2. ID入力画面
QRコードを読み取ると、ブラウザで以下の画面が表示されます:

```
┌─────────────────────────────┐
│   ライブ入場確認             │
│   CAMPFIRE IDで入場権利を確認 │
├─────────────────────────────┤
│   CAMPFIRE ID               │
│   [入力欄________________]  │
│                             │
│   [入場権利を確認]           │
│                             │
│   ※CAMPFIREから通知された    │
│     IDを入力してください      │
└─────────────────────────────┘
```

**操作手順:**
1. 「CAMPFIRE ID」の入力欄をタップ
2. CAMPFIREから事前に通知されたIDを入力
   - 例: `user12345`
   - 大文字・小文字を正確に入力してください
   - スペースや記号にも注意してください
3. 「入場権利を確認」ボタンをタップ
4. 数秒間「確認中...」と表示されます

#### 3. 結果画面（3パターン）

**パターン1: 入場OK + リハ見学OK画面（緑色）**
```
┌─────────────────────────────┐
│        ✓✓                   │
│      (大きな緑のアイコン)      │
│                             │
│   入場OK + リハ見学OK        │
│                             │
│   ようこそ!                  │
│   ライブ会場とリハーサル見学へ  │
│   お進みください              │
│                             │
│   お名前: 山田太郎            │
│   リターン: 入場券+グッズ      │
│   リハ見学: 可能              │
│                             │
│   [最初に戻る]               │
└─────────────────────────────┘
```
- **入場権利とリハ見学権利の両方あり**
- ライブ会場とリハーサル見学の両方に入場可能
- この画面をスタッフに見せてください

**パターン2: 入場OK画面（オレンジ色）**
```
┌─────────────────────────────┐
│         ✓                   │
│     (大きなオレンジのアイコン) │
│                             │
│      入場OK                 │
│                             │
│   ようこそ!                  │
│   ライブ会場へお進みください   │
│   ※リハーサル見学権利はありません │
│                             │
│   お名前: 佐藤花子            │
│   リターン: 入場券のみ         │
│                             │
│   [最初に戻る]               │
└─────────────────────────────┘
```
- **入場権利のみあり（リハ見学権利なし）**
- ライブ会場への入場は可能
- リハーサル見学には参加できません

**パターン3: 入場NG画面（赤色）**
```
┌─────────────────────────────┐
│         ✕                   │
│      (大きな赤のアイコン)      │
│                             │
│      入場NG                 │
│                             │
│   入場権利が確認できません     │
│   スタッフにお声がけください    │
│                             │
│   [最初に戻る]               │
└─────────────────────────────┘
```
- **入場権利なし**
- 近くのスタッフにお声がけください
- IDを再確認してもらいます

#### 4. エラーが表示された場合

**「IDを入力してください」**
- 入力欄が空の状態で確認ボタンを押した場合に表示されます
- IDを入力してから再度確認してください

**「該当するIDが見つかりません」**
- 入力したIDが登録されていない可能性があります
- IDを再確認するか、スタッフにお声がけください

**「システムエラーが発生しました」**
- 通信エラーまたはシステムの問題が発生しています
- 以下を試してください:
  1. ブラウザをリロード（画面を引っ張って更新）
  2. Wi-Fi接続を確認
  3. それでも解決しない場合はスタッフにお声がけください

#### よくある質問

**Q: IDが分からなくなった**
A: CAMPFIREから送られたメールをご確認ください。見つからない場合はスタッフにお声がけください。

**Q: 何度試してもエラーになる**
A: 以下を確認してください:
- IDに余計なスペースが入っていないか
- 大文字・小文字が正しいか
- インターネットに接続されているか

**Q: 画面が真っ白になった**
A: ブラウザをリロード（更新）してください。

---

### スタッフ向け運用マニュアル

#### イベント前日の準備

**1. システム動作確認**
- [ ] QRコードが正しくシステムURLに飛ぶか確認
- [ ] テストIDで入場確認が正常に動作するか確認
- [ ] スプレッドシートのデータが最新か確認
- [ ] Wi-Fi環境の動作確認

**2. 必要な準備物**
- [ ] QRコード印刷物（複数箇所に設置推奨）
- [ ] スタッフ用スマートフォンまたはタブレット（予備機）
- [ ] 紙の来場者リスト（バックアップ用）
- [ ] モバイルWi-Fiルーター（予備回線）

#### イベント当日の運用フロー

**1. 開場前（30分前）**
```
□ QRコードを入口の目立つ場所に設置
□ Wi-Fi動作確認
□ システムの動作確認（テストIDで確認）
□ スタッフ全員が操作方法を理解しているか確認
□ バックアッププランの確認
```

**2. 開場中の対応**

**ケース1a: 入場OK + リハ見学OK画面（緑色）を見せられた場合**
```
1. 画面を確認
   - 緑色の「入場OK + リハ見学OK」画面か確認
   - ✓✓アイコンを確認
   - ユーザー情報（氏名・リターン内容・リハ見学: 可能）を確認
2. 来場者をリストで確認（任意）
3. 「ようこそ、お楽しみください！リハーサル見学もご参加いただけます」と案内
4. 会場内へ誘導
5. リハーサル見学エリアの場所を案内
```

**ケース1b: 入場OK画面（オレンジ色）を見せられた場合**
```
1. 画面を確認
   - オレンジ色の「入場OK」画面か確認
   - ✓アイコンを確認
   - 「※リハーサル見学権利はありません」の表示を確認
2. 来場者をリストで確認（任意）
3. 「ようこそ、お楽しみください！」と案内
4. 「リハーサル見学権利はございませんのでご了承ください」と説明
5. 会場内（リハ見学エリア以外）へ誘導
```

**ケース2: 入場NG画面を見せられた場合**
```
1. 画面を確認（赤色の「入場NG」画面）
2. 来場者に丁寧に事情を説明
   「申し訳ございません。入場権利が確認できませんでした」
3. IDを再確認
   - CAMPFIRE IDを口頭で確認
   - 再度入力してもらう
4. それでもNGの場合
   - スプレッドシートで直接確認
   - 入場権利列（D列）が「無」になっていないか確認
5. 状況に応じて対応
   - データミス: その場でスプレッドシートを修正
   - 本当に権利なし: 丁寧に説明し、別途対応を検討
```

**ケース3: エラー画面・システムエラー**
```
1. 来場者のスマートフォンを確認
   - インターネット接続を確認
   - ブラウザをリロードしてもらう
2. それでも解決しない場合
   - スタッフ用端末で代わりに確認
3. システム全体がダウンしている場合
   - バックアッププラン発動
   - 紙のリストで手動確認
   - 後で記録を残す
```

**ケース4: IDが分からない来場者**
```
1. CAMPFIREからのメールを確認してもらう
2. メールが見つからない場合
   - 氏名でスプレッドシート検索
   - B列（氏名）で該当者を探す
   - 見つかったらA列のCAMPFIRE IDを教える
3. それでも見つからない場合
   - 支援確認メールや決済情報を確認
   - 必要に応じて上長に報告
```

**ケース5: スマートフォンを持っていない来場者**
```
1. スタッフ用端末でID入力を代行
2. 口頭でCAMPFIRE IDを聞く
3. 代わりに確認して結果を伝える
4. 問題なければ入場を許可
```

#### トラブルシューティング

**問題: システムが全く動かない**

**原因チェックリスト:**
- [ ] Wi-Fi接続は正常か
- [ ] Google Apps Scriptがダウンしていないか
- [ ] スプレッドシートへのアクセス権限は問題ないか

**対応:**
1. 別のネット回線（モバイルデータ）で試す
2. 5分待ってから再試行
3. バックアッププラン（紙リスト）に切り替え

**問題: 特定のIDだけエラーになる**

**確認事項:**
- [ ] スプレッドシートにそのIDが登録されているか
- [ ] A列のCAMPFIRE_IDに余計なスペースや改行がないか
- [ ] D列の入場権利が「有」または「無」で正しく入力されているか

**対応:**
1. スプレッドシートを直接確認
2. データに問題があれば修正
3. 修正後すぐに反映される（再デプロイ不要）

**問題: レスポンスが遅い**

**原因:**
- 同時アクセス数が多い
- インターネット回線が混雑

**対応:**
1. 来場者に少し待ってもらう（通常5秒以内）
2. 複数のスタッフで分散して対応
3. 長時間改善しない場合はバックアッププランへ

#### データ管理

**当日のデータ更新**
- スプレッドシートは直接編集可能
- 修正後すぐに反映される（リアルタイム）
- 再デプロイは不要

**更新手順:**
1. Googleスプレッドシートを開く
2. 該当行を編集
3. 保存（自動保存）
4. すぐに反映される

#### 終了後の確認

**イベント終了後チェックリスト:**
- [ ] QRコードの撤去
- [ ] 当日のトラブル記録
- [ ] システム利用統計の確認（Apps Scriptログ）
- [ ] 改善点のメモ
- [ ] 次回イベントへの引き継ぎ事項

#### 緊急連絡先

```
システム管理者: [連絡先]
会場責任者: [連絡先]
バックアップ担当: [連絡先]
```

#### スタッフ向けクイックリファレンス

| 画面の色 | アイコン | 状態 | 対応 |
|---------|---------|------|------|
| 緑 | ✓✓ | 入場OK + リハ見学OK | 入場を許可、リハ見学エリアも案内 |
| オレンジ | ✓ | 入場OK（リハ見学NG） | 入場を許可、リハ見学不可を説明 |
| 赤 | ✕ | 入場NG | IDを再確認、スプレッドシート確認 |
| 赤文字エラー | - | システムエラー | リロード、別端末で試行 |
| 白（真っ白） | - | 読み込み失敗 | リロード、ネット接続確認 |

## テスト方法

### ローカルテスト
1. `index.html` をブラウザで開く
2. テスト用のCAMPFIRE IDを入力
3. 正しく動作するか確認

### デプロイ後のテスト
1. GitHub PagesのURLにアクセス
2. スプレッドシートに登録したテストデータで確認
3. スマートフォンでQRコードを読み取ってテスト

### Apps Scriptのテスト
Apps Scriptエディタから以下の関数を実行してデバッグ可能:
- `testSearchUser()`: ユーザー検索のテスト
- `checkSheetStructure()`: スプレッドシート構造の確認

## トラブルシューティング

### システムエラーが表示される

**原因**: Apps Script URLが正しく設定されていない

**対処法**:
1. `script.js` の `SCRIPT_URL` を確認
2. Apps ScriptのデプロイURLが正しいか確認
3. Apps Scriptが「全員」アクセス可能に設定されているか確認

### IDが見つからない

**原因**: スプレッドシートにデータが登録されていない

**対処法**:
1. スプレッドシートの「入場者リスト」シートを確認
2. CAMPFIRE_ID (A列) が正しく入力されているか確認
3. 入力したIDにスペースや特殊文字が含まれていないか確認

### 通信エラーが発生する

**原因**: ネットワーク接続の問題

**対処法**:
1. Wi-Fi接続を確認
2. モバイルデータ通信に切り替え
3. ブラウザをリロード

### CORSエラーが発生する

**原因**: Apps Scriptのデプロイ設定が正しくない

**対処法**:
1. Apps Scriptを再デプロイ
2. 「アクセスできるユーザー」を「全員」に設定

## セキュリティについて

- **HTTPS通信**: GitHub PagesとApps Scriptは両方ともHTTPSに対応
- **データ保護**: スプレッドシートのURLは非公開
- **アクセス制御**: スプレッドシートはスクリプト実行者のみ閲覧可能
- **入力値検証**: XSS対策としてHTMLエスケープを実施

## パフォーマンス

- **照合処理**: 通常3秒以内、最大5秒以内
- **同時アクセス**: 小規模会場向け（10-20人程度）
- **Apps Script制限**: 1日あたり20,000回まで実行可能

## 制約事項

- インターネット接続が必須
- Googleアカウントでのスプレッドシート管理が必要
- Apps Scriptの実行回数制限に準拠
- 大規模会場での高負荷動作は保証対象外


## 作成日

2025年11月19日

## バージョン

1.0.0

## お問い合わせ

問題が発生した場合は、GitHubのIssuesで報告してください。
